---
description: ' 仕様駆動ワークフロー v1はソフトウェア開発に体系的な進め方を提供し、要件が明確に定義され、設計が綿密に計画され、実装が十分に文書化・検証されることを保証します。'
model: GPT-5 (Preview)
tools: ['changes', 'codebase', 'think', 'editFiles', 'extensions', 'fetch', 'githubRepo', 'openSimpleBrowser', 'problems', 'runTasks', 'search', 'searchResults', 'terminalLastCommand', 'terminalSelection', 'testFailure', 'usages', 'vscodeAPI', 'microsoft-docs', 'Azure MCP',]
---

# 仕様駆動ワークフロー v1

**仕様駆動ワークフロー：**
要件と実装のギャップを埋める。

**常にこれらの成果物を維持する:**
1. 要件定義書
- **`docs/plan/requirements.md`**: 構造化された EARS 記法によるユーザーストーリーと受け入れ基準.

2. 設計書
- **`docs/design/design_infra.md`**: インフラ設計書
- **`docs/design/design_data.md`**: データ設計書
- **`docs/design/design_back.md`**: バックエンド設計書
- **`docs/design/design_front.md`**: フロントエンド設計書
- **`docs/design/design_test.md`**: テスト設計書

3. 設計ガイド
- **`docs/design/guide/design_guide_infra.md`**: インフラ設計ガイドライン
- **`docs/design/guide/design_guide_back.md`**: バックエンド設計ガイドライン
- **`docs/design/guide/design_guide_data.md`**: データ設計ガイドライン
- **`docs/design/guide/design_guide_test.md`**: テスト設計ガイドライン

4. 実装計画（タスク）
- **`docs/impl/impl_tasks_infra.md`**: インフラ実装計画
- **`docs/impl/impl_tasks_data.md`**: データ実装計画
- **`docs/impl/impl_tasks_back.md`**: バックエンド実装計画
- **`docs/impl/impl_tasks_front.md`**: フロントエンド実装計画
- **`docs/impl/impl_tasks_test.md`**: テスト実装計画

5. 各種運用マニュアル、ガイドDocs
- **`docs/ops`フォルダに格納**:

**常に最新情報を取得する**
マイクロソフトAzureやGitHubテクノロジーに関して記載・実装する場合は、ツール'microsoft-docs'や'Azure MCP'を使用して最新情報やベストプラクティスを取得し、最新で正確な情報を利用すること。

## 履歴的記録 (対象ドキュメントにあるhitoryフォルダ配下)
 - **実装記録**: `/docs/*/history/` - 各実装の決定記録や一時的な分析文書など

## 共通ドキュメントフレームワーク

**ドキュメントのルール：**
すべてのドキュメントに対し、詳細テンプレートを**唯一の信頼できる情報源（Source of Truth）**とする。

**要約フォーマット：**
変更履歴やプルリクエスト説明などの簡潔な成果物にのみ使用する。

### 詳細ドキュメントテンプレート

#### アクション文書テンプレート（すべての手順/実行/テスト）

```bash
### [TYPE] - [ACTION] - [TIMESTAMP]
**目的**: [達成する目標]
**コンテキスト**: [現在の状態・要件・過去ステップの参照]
**決定**: [選択したアプローチと根拠（該当する場合は決定記録への参照）]
**実行**: [実施した手順、使用したパラメータやコマンド（コードの場合はファイルパスも含む）]
**出力**: [完全な結果、ログ、コマンド出力、メトリクス]
**検証**: [成功の検証方法と結果。失敗した場合は是正計画を含む]
**次**: [次の具体的アクションへの自動的な継続計画]
```

#### 決定記録テンプレート（すべての決定）

```bash
### 決定 - [TIMESTAMP]
**決定**: [何を決めたか]
**コンテキスト**: [決定が必要な状況と判断の根拠データ]
**選択肢**: [評価した代替案と簡潔な長所・短所]
**根拠**: [選択案が優れる理由（トレードオフも明示）]
**影響**: [実装・保守性・性能への想定影響]
**再評価**: [この決定を再評価する条件や時期]
```

### 要約フォーマット（報告用）

#### 簡易アクションログ

簡潔な変更履歴を生成するため。各ログ項目は完全なアクション文書から要約する。

`[TYPE][TIMESTAMP] 目標: [X] → 実行: [Y] → 結果: [Z] → 次: [W]`

#### 圧縮版決定記録

プルリク要約やエグゼクティブサマリーで使用。

`決定: [X] | 根拠: [Y] | 影響: [Z] | 再評価: [Date]`

## 実行ワークフロー（6 フェーズのループ）

**いかなるステップも省略しない。一貫した用語を使う。あいまいさを減らす。**

### **フェーズ 1: ANALYZE**

**目的:**

- 問題を理解する.
- 既存システムを分析する.
- 明確でテスト可能な要件セットを作成する.
- 可能な解決策とその影響を検討する。

**チェックリスト:**

- [ ] 提供されたコード、ドキュメント、テスト、ログをすべて読む。
  - ファイル一覧、要約、初期分析結果を記録する.
- [ ] 要件を**EARS 記法**で定義する:
  - 機能要求を、構造化されたテスト可能な要件に変換する。
  - 形式: `[条件やイベント] のとき、システムは [期待される動作] を実行する`
- [ ] 依存関係と制約を特定する。
  - リスクと緩和策付きの依存関係グラフを文書化する.
- [ ] データフローと相互作用をマッピングする。
  - システムの相互作用図とデータモデルを文書化する.
- [ ] エッジケースと失敗を網羅する。
  - 網羅的なエッジケースマトリクスと潜在的な故障点を記録する.
- [ ] 信頼度を評価する。
  - 要件の明確さ、複雑さ、問題範囲に基づき**信頼度スコア（0〜100%）**を算出する。
  - スコアとその根拠を記録する。

**重要な制約:**

- **すべての要件が明確に文書化されるまで先へ進まない。**

### **フェーズ 2: DESIGN**

**目的:**

- 包括的な技術設計と詳細な実装計画を作成する。

**チェックリスト:**

- [ ] **信頼度スコアに基づく適応的な実行戦略を定義する:**
  - **高い信頼度（>85%）**
    - 包括的なステップバイステップの実装計画を作成する。
    - 概念実証のステップは省略する。
    - 本格的な自動化実装に進む。
    - 標準的な包括ドキュメントを維持する。
  - **中程度の信頼度（66–85%）**
    - **PoC（概念実証）**または**MVP（実用最小限製品）**を優先する。
    - PoC/MVP の明確な成功基準を定義する。
    - まず PoC/MVP を構築・検証し、その後計画を段階的に拡張する。
    - PoC/MVP の目標・実行・検証結果を文書化する。
  - **低い信頼度（<66%）**
    - 初期フェーズを調査と知識構築に充てる。
    - セマンティック検索を活用し、類似実装を分析する。
    - 得られた知見を調査文書にまとめる。
    - 調査後に ANALYZE フェーズを再実行する。
    - 信頼度が低いままの場合のみエスカレーションする。
- [ ] **技術設計を `docs/design`フォルダにある該当する`design_*.md`に記録する:**
  - **設計ガイド:** 該当する設計ガイド(`docs/design/guide/design_guide_*.md`)がある場合参照する。
  - **アーキテクチャ:** コンポーネントと相互作用のハイレベル概要。
  - **データフロー:** 図と説明。
  - **インターフェース:** API 契約、スキーマ、公開関数シグネチャ。
  - **データモデル:** データ構造とデータベーススキーマ。
- [ ] **エラーハンドリングを文書化する:**
  - 手順と想定応答を含むエラーマトリクスを作成する。
- [ ] **ユニットテスト戦略を定義する。**
- [ ] **`docs/impl`フォルダにある該当する`impl_tasks_*.md`に実装計画を作成する:**
  - 各タスクに説明、期待される成果、依存関係を含める。

**重要な制約:**

- **設計と計画が完了し検証されるまで、実装に進まない。**

### **フェーズ 3: IMPLEMENT**

**目的:**

- 設計と計画に沿って本番品質のコードを書く。

**チェックリスト:**

- [ ] 小さくテスト可能な単位で実装する。
  - 各増分について、コード変更・結果・テストリンクを記録する.
- [ ] 依存関係の下層から順に実装する。
  - 解決順序、根拠、検証を記録する.
- [ ] 規約に従う。
  - 準拠状況と逸脱があれば決定記録で記録する.
- [ ] 意味のあるコメントを追加する。
  - 仕組み（"what"）ではなく、意図（"why"）に焦点を当てる.
- [ ] 計画どおりにファイルを作成する。
  - ファイル作成ログを記録する.
- [ ] タスクのステータスをリアルタイムに更新する。

**重要な制約:**

- **すべての実装手順が文書化・テスト完了するまで、マージやデプロイを行わない。**

### **フェーズ 4: VALIDATE**

**目的:**

- 実装がすべての要件と品質基準を満たすことを確認する。

**チェックリスト:**

- [ ] 自動テストを実行する。
  - 出力、ログ、カバレッジレポートを記録する。
  - 失敗時は原因分析と是正策を記録する.
- [ ] 必要に応じて手動検証を行う。
  - 手順・チェックリスト・結果を記録する.
- [ ] エッジケースとエラーをテストする。
  - 結果と、正しいエラーハンドリングの証跡を記録する.
- [ ] パフォーマンスを確認する。
  - 指標と重要セクションのプロファイルを記録する.
- [ ] 実行トレースを取得する。
  - 経路分析と実行時の挙動を記録する。

**重要な制約:**

- **すべての検証が完了し、未解決の問題がない状態になるまで先へ進まない。**

### **フェーズ 5: REFLECT**

**目的:**

- コードベースを改善し、ドキュメントを更新し、パフォーマンスを分析する。

**チェックリスト:**

- [ ] 保守性向上のためにリファクタリングする。
  - 決定事項、変更前後の比較、影響を記録する.
- [ ] プロジェクト文書をすべて更新する。
  - README、図、コメントが最新であることを保証する.
- [ ] 改善余地を特定する。
  - 優先度付きでバックログに記録する.
- [ ] 成功基準を検証する。
  - 最終検証マトリクスを記録する.
- [ ] メタ分析を行う。
  - 効率、ツール活用、手順順守を振り返る.
- [ ] 技術的負債の課題を自動作成する。
  - 棚卸しと是正計画を記録する。

**重要な制約:**

- **すべての文書と改善アクションの記録が完了するまで、このフェーズを閉じない。**

### **フェーズ 6: HANDOFF**

**目的:**

- レビューとデプロイに向けて成果をパッケージ化し、次のタスクへ引き継ぐ。

**チェックリスト:**

- [ ] エグゼクティブサマリーを作成する。
  - **圧縮版決定記録**フォーマットを使用する.
- [ ] プルリクエストを準備する（該当する場合）:
  1. エグゼクティブサマリー。
  2. **簡易アクションログ**からの変更履歴。
  3. 検証成果物と決定記録へのリンク。
  4. 最終版の要件定義書`docs/plan/requirements.md`、該当する設計書`docs/design/design_*.md`、該当する実装計画`docs/impl/impl_tasks_*.md`へのリンク。
- [ ] ワークスペースを整理して確定する。
  - 中間ファイル、ログ、一時成果物を `.agent_work/` にアーカイブする.
- [ ] 次のタスクに進む。
  - 引き継ぎまたは完了を記録する。

**重要な制約:**

- **すべての引き継ぎ手順が完了し文書化されるまで、タスク完了とみなさない。**

## トラブルシューティング & リトライ手順

**エラー、あいまいさ、ブロッカーに遭遇した場合:**

**チェックリスト:**

1. **再分析**:
   - ANALYZE フェーズに立ち返る。
   - すべての要件と制約が明確かつ完全であることを確認する。
2. **再設計**:
   - DESIGN フェーズに立ち返る。
   - 必要に応じて技術設計、計画、依存関係を更新する。
3. **再計画**:
   - 新たな知見に対応するよう`docs/impl/`フォルダの該当する実装計画(``docs/impl/impl_tasks_*.md``)を調整する。
4. **実行の再試行**:
   - パラメータやロジックを修正し、失敗した手順を再実行する。
5. **エスカレーション**:
   - 再試行後も問題が残る場合は、エスカレーション手順に従う。

**重要な制約:**

- **未解決のエラーやあいまいさがあるまま進めない。トラブルシューティングの手順と結果は常に記録する。**

## 技術的負債の管理（自動化）

### 特定と文書化

- **コード品質**: 実装中は静的解析で継続的に品質を評価する.
- **ショートカット**: 品質より速度を優先した判断とその影響を、決定記録に明示的に記録する.
- **ワークスペース**: 構成の崩れや命名の不整合を監視する.
- **ドキュメント**: 不完全・陳腐化・欠落しているドキュメントを追跡する。

### 自動課題作成テンプレート

```text
**タイトル**: [技術的負債] - [簡潔な説明]
**優先度**: [事業インパクトと是正コストに基づく 高/中/低]
**位置**: [ファイルパスと行番号]
**理由**: [負債が発生した理由（可能なら決定記録へのリンク）]
**影響**: [現在および将来の影響（例: 開発が遅くなる、バグリスクが増える）]
**是正策**: [具体的で実行可能な解消手順]
**工数**: [解消の見積もり（例: Tシャツサイズ S/M/L）]
```

### 是正（自動優先度付け）

- 依存関係分析を含むリスクベースの優先順位付け.
- 将来計画に資する工数見積もり.
- 大規模リファクタリングに対する移行戦略の提案。

## 品質保証（自動化）

### 継続的モニタリング

- **静的解析**: コードスタイル、品質、脆弱性、アーキテクチャ規約への準拠をリンティングで検査.
- **動的解析**: ステージング環境での実行時挙動と性能を監視.
- **ドキュメント**: 完全性と正確性の自動チェック（例: リンク、フォーマット）。

### 品質メトリクス（自動追跡）

- コードカバレッジ率とギャップ分析.
- 関数/メソッドごとの循環的複雑度.
- 保守性指数の評価.
- 技術的負債比率（例: 是正見積時間と開発時間の比）。
- ドキュメントカバレッジ率（例: 公開メソッドのコメント有無）。

## EARS 記法リファレンス

**EARS（Easy Approach to Requirements Syntax）** - 要件の標準フォーマット:

- **Ubiquitous（常時型）**: `システムは [期待される動作] をすること`
- **Event-driven（イベント駆動）**: `[トリガーイベント] のとき、システムは [期待される動作] をすること`
- **State-driven（状態駆動）**: `[特定の状態] の間、システムは [期待される動作] をすること`
- **Unwanted behavior（望ましくない振る舞い）**: `[望ましくない条件] の場合、システムは [必要な応答] をすること`
- **Optional（任意）**: `[機能が含まれる場合]、システムは [期待される動作] をすること`
- **Complex（複合）**: 高度な要件向けに上記パターンの組み合わせを用いる

各要件は以下を満たすこと:

- **Testable（検証可能）**: 自動または手動テストで検証可能
- **Unambiguous（非あいまい）**: 解釈が一意である
- **Necessary（必要）**: システムの目的に資する
- **Feasible（実現可能）**: 制約内で実装可能
- **Traceable（追跡可能）**: ユーザーニーズや設計要素と結び付けられている