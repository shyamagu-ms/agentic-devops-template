---
description: '設計書作成ワークフローは、要件定義書を元に実装可能なレベルの設計書を作成します。'
tools: ['edit', 'changes', 'search', 'extensions', 'fetch', 'githubRepo', 'openSimpleBrowser', 'problems', 'runTasks', 'search', 'todos', 'runCommands',  'testFailure', 'usages', 'vscodeAPI', 'microsoft-docs/*', 'Azure MCP/*']
---
# 設計書作成ワークフロー

要件書やその他参考情報から設計書を作成する。
**実装成果物は含まれない。**

**常にこれらの成果物を維持する:**
成果物はすべて [/docs/design](../../docs/design) に保存する。

**常に最新情報を取得する**
マイクロソフトAzureやGitHubテクノロジーに関して記載する場合は、ツール'microsoft-docs'を使用して最新情報を取得し、最新で正確な全情報を読み込むこと。

### 作成するドキュメント（/docs/design直下）
- **`design_infra.md`**: インフラ設計書、実装はbicepを想定
- **`design_data.md`**: データベース設計書、テーブル定義や必要なスクリプトなど
- **`design_back.md`**: API設計書、エンドポイント定義やリクエスト/レスポンス形式
- **`design_front.md`**: フロントエンド設計書、コンポーネント構成や状態管理の方針、APIとの連携方法
- **`design_test.md`**: 単体・結合・性能・E2Eのテスト設計書、方針と手順

### 履歴的記録 (/docs/history/)
 - 一時的な分析文書など

 **ドキュメント管理方針**
  - [要件定義書](../../docs/plan/requirements.md)は常に最新の状態を反映する
  - タイムスタンプ付きの記録や履歴的な文書は/docs/design/history/配下の適切なサブディレクトリに保存する
  - この構造により、現在の状態と過去の決定プロセスの両方を明確に管理する
  - **すべてのドキュメント内の図表（アーキテクチャ図、シーケンス図、データフロー図、状態遷移図など）はMermaid記法で作成する**

## 実行ワークフロー（5フェーズループ）

**ステップをスキップしない。一貫した用語を使用する。曖昧さを減らす。**

**重要なプロセス制約:**
- **各フェーズ完了時に次フェーズへの進行について合意を得る**
- ユーザーの承認なしに次のフェーズに自動的に進まない
- フェーズ間の移行では明確なチェックポイントを提示する
- 不完全なフェーズでの進行を防ぐための確認プロセスを実施する

### **フェーズ1: インフラ設計**

**目的:**

- [要件定義書](../../docs/plan/requirements.md)をもとに、包括的な技術設計と詳細なBicep実装計画を作成する。
- 設計ガイドとして、[インフラ設計ガイド](../../docs/design/guide/design_guide_infra.md)を**必ず参照すること**。
- 設計書は `/docs/design/design_infra.md` に、タスクに落とし込んだ実装計画は `/docs/impl/impl_tasks_infra.md` に保存する。

**チェックリスト:**

- [ ] **信頼度スコアに基づいて適応的な実行戦略を定義する:**
  - **高信頼度（>85%）**
    - 包括的で段階的な実装計画をドラフトする。
    - 概念実証ステップをスキップする。
    - 完全で自動化された実装を進める。
    - 標準的な包括的なドキュメンテーションを維持する。
  - **中程度の信頼度（66-85%）**
    - **概念実証（PoC）**または**最小実行可能製品（MVP）**を優先する。
    - PoC/MVPの明確な成功基準を定義する。
    - 最初にPoC/MVPを構築して検証し、その後計画を段階的に拡張する。
    - PoC/MVPの目標、実行、検証結果を文書化する。
  - **低信頼度（<66%）**
    - 最初のフェーズを研究と知識構築に専念する。
    - セマンティック検索を使用し、類似の実装を分析する。
    - 調査結果を研究文書に統合する。
    - 研究後に分析フェーズを再実行する。
    - 信頼度が低いままの場合のみエスカレートする。

- [ ] **技術設計を`design_infra.md`に文書化する:**
  - **アーキテクチャ:** コンポーネントと相互作用の高レベルの概要（Mermaid記法で図を作成）。
  - **データフロー:** 図と説明（Mermaid記法を使用）。
  - **インターフェース:** APIコントラクト、スキーマ、公開関数シグネチャ。
  - **データモデル:** データ構造とデータベーススキーマ（ERD図はMermaid記法で作成）。

- [ ] **エラー処理を文書化する:**
  - 手順と期待される応答を含むエラーマトリックスを作成する。

- [ ] **単体テスト戦略を定義する。**

- [ ] **実装計画を作成する:**
  - 各タスクについて、説明、期待される結果、依存関係を含める。
  - 注: impl_tasks_infra.mdは/docs/impl/に保存される。

**重要な制約:**

- **設計と計画が完成し検証されるまで次のフェーズには進まない。**

### **フェーズ2: データ設計**

**目的:**

- [要件定義書](../../docs/plan/requirements.md)をもとに、包括的なデータベース設計と詳細なSQL実装計画を作成する。
- 設計ガイドとして、[データ設計ガイド](../../docs/design/guide/design_guide_data.md)を**必ず参照すること**。
- 設計書は `/docs/design/design_data.md` に、タスクに落とし込んだ実装計画は `/docs/impl/impl_tasks_data.md` に保存する。

**チェックリスト:**

- [ ] **信頼度スコアに基づいて適応的な実行戦略を定義する:**
  - **高信頼度（>85%）**
    - 包括的で段階的な実装計画をドラフトする。
    - 概念実証ステップをスキップする。
    - 完全で自動化された実装を進める。
    - 標準的な包括的なドキュメンテーションを維持する。
  - **中程度の信頼度（66-85%）**
    - **概念実証（PoC）**または**最小実行可能製品（MVP）**を優先する。
    - PoC/MVPの明確な成功基準を定義する。
    - 最初にPoC/MVPを構築して検証し、その後計画を段階的に拡張する。
    - PoC/MVPの目標、実行、検証結果を文書化する。
  - **低信頼度（<66%）**
    - 最初のフェーズを研究と知識構築に専念する。
    - セマンティック検索を使用し、類似の実装を分析する。
    - 調査結果を研究文書に統合する。
    - 研究後に分析フェーズを再実行する。
    - 信頼度が低いままの場合のみエスカレートする。

- [ ] **技術設計を`design_data.md`に文書化する:**
  - **アーキテクチャ:** コンポーネントと相互作用の高レベルの概要（Mermaid記法で図を作成）。
  - **データフロー:** 図と説明（Mermaid記法を使用）。
  - **インターフェース:** APIコントラクト、スキーマ、公開関数シグネチャ。
  - **データモデル:** データ構造とデータベーススキーマ（ERD図はMermaid記法で作成）。

- [ ] **エラー処理を文書化する:**
  - 手順と期待される応答を含むエラーマトリックスを作成する。

- [ ] **単体テスト戦略を定義する。**

- [ ] **実装計画を作成する:**
  - 各タスクについて、説明、期待される結果、依存関係を含める。
  - 注: impl_tasks_data.mdは/docs/impl/に保存される。

**重要な制約:**

- **設計と計画が完成し検証されるまで次のフェーズには進まない。**

### **フェーズ3: バックエンド設計**

**目的:**

- [要件定義書](../../docs/plan/requirements.md)をもとに、包括的なバックエンド設計と詳細なAPI実装計画を作成する。
- 設計ガイドとして、[バックエンド設計ガイド](../../docs/design/guide/design_guide_back.md)を**必ず参照すること**。
- 設計書は `/docs/design/design_back.md` に、タスクに落とし込んだ実装計画は `/docs/impl/impl_tasks_back.md` に保存する。

**チェックリスト:**

- [ ] **信頼度スコアに基づいて適応的な実行戦略を定義する:**
  - **高信頼度（>85%）**
    - 包括的で段階的な実装計画をドラフトする。
    - 概念実証ステップをスキップする。
    - 完全で自動化された実装を進める。
    - 標準的な包括的なドキュメンテーションを維持する。
  - **中程度の信頼度（66-85%）**
    - **概念実証（PoC）**または**最小実行可能製品（MVP）**を優先する。
    - PoC/MVPの明確な成功基準を定義する。
    - 最初にPoC/MVPを構築して検証し、その後計画を段階的に拡張する。
    - PoC/MVPの目標、実行、検証結果を文書化する。
  - **低信頼度（<66%）**
    - 最初のフェーズを研究と知識構築に専念する。
    - セマンティック検索を使用し、類似の実装を分析する。
    - 調査結果を研究文書に統合する。
    - 研究後に分析フェーズを再実行する。
    - 信頼度が低いままの場合のみエスカレートする。

- [ ] **技術設計を`design_back.md`に文書化する:**
  - **アーキテクチャ:** コンポーネントと相互作用の高レベルの概要（Mermaid記法で図を作成）。
  - **データフロー:** 図と説明（Mermaid記法を使用）。
  - **インターフェース:** APIコントラクト、スキーマ、公開関数シグネチャ。
  - **データモデル:** データ構造とデータベーススキーマ（ERD図はMermaid記法で作成）。

- [ ] **エラー処理を文書化する:**
  - 手順と期待される応答を含むエラーマトリックスを作成する。

- [ ] **単体テスト戦略を定義する。**

- [ ] **実装計画を作成する:**
  - 各タスクについて、説明、期待される結果、依存関係を含める。
  - 注: impl_tasks_back.mdは/docs/impl/に保存される。

**重要な制約:**

- **設計と計画が完成し検証されるまで次のフェーズには進まない。**

### **フェーズ4: フロントエンド設計**

**目的:**

- 既存の[フロントエンド成果物](../../front/)と[要件定義書](../../docs/plan/requirements.md)をもとに、包括的なフロントエンド設計と詳細なUI実装計画を作成する。
- 既存の成果物に加えて要件定義書との差分を取り込んだ包括的な設計を行う。
- 設計書は `/docs/design/design_front.md` に、追加要件に対応するためのタスクに落とし込んだ実装計画は `/docs/impl/impl_tasks_front.md` に保存する。

**チェックリスト:**

- [ ] **信頼度スコアに基づいて適応的な実行戦略を定義する:**
  - **高信頼度（>85%）**
    - 包括的で段階的な実装計画をドラフトする。
    - 概念実証ステップをスキップする。
    - 完全で自動化された実装を進める。
    - 標準的な包括的なドキュメンテーションを維持する。
  - **中程度の信頼度（66-85%）**
    - **概念実証（PoC）**または**最小実行可能製品（MVP）**を優先する。
    - PoC/MVPの明確な成功基準を定義する。
    - 最初にPoC/MVPを構築して検証し、その後計画を段階的に拡張する。
    - PoC/MVPの目標、実行、検証結果を文書化する。
  - **低信頼度（<66%）**
    - 最初のフェーズを研究と知識構築に専念する。
    - セマンティック検索を使用し、類似の実装を分析する。
    - 調査結果を研究文書に統合する。
    - 研究後に分析フェーズを再実行する。
    - 信頼度が低いままの場合のみエスカレートする。

- [ ] **技術設計を`design_front.md`に文書化する:**
  - **アーキテクチャ:** コンポーネントと相互作用の高レベルの概要（Mermaid記法で図を作成）。
  - **データフロー:** 図と説明（Mermaid記法を使用）。
  - **インターフェース:** APIコントラクト、スキーマ、公開関数シグネチャ。
  - **データモデル:** データ構造とデータベーススキーマ（ERD図はMermaid記法で作成）。

- [ ] **エラー処理を文書化する:**
  - 手順と期待される応答を含むエラーマトリックスを作成する。

- [ ] **単体テスト戦略を定義する。**

- [ ] **実装計画を作成する:**
  - 各タスクについて、説明、期待される結果、依存関係を含める。
  - 注: impl_tasks_front.mdは/docs/impl/に保存される。

**重要な制約:**

- **設計と計画が完成し検証されるまで次のフェーズには進まない。**

### **フェーズ5: テスト設計**

**目的:**

- [要件定義書](../../docs/plan/requirements.md)をもとに、包括的なテスト設計を作成する。
- 設計ガイドとして、[テスト設計ガイド](../../docs/design/guide/design_guide_test.md)を**必ず参照すること**。
- 設計書は `/docs/design/design_test.md` に、タスクに落とし込んだ実装計画は `/docs/impl/impl_tasks_test.md` に保存する。

**チェックリスト:**

- [ ] **信頼度スコアに基づいて適応的な実行戦略を定義する:**
  - **高信頼度（>85%）**
    - 包括的で段階的な実装計画をドラフトする。
    - 概念実証ステップをスキップする。
    - 完全で自動化された実装を進める。
    - 標準的な包括的なドキュメンテーションを維持する。
  - **中程度の信頼度（66-85%）**
    - **概念実証（PoC）**または**最小実行可能製品（MVP）**を優先する。
    - PoC/MVPの明確な成功基準を定義する。
    - 最初にPoC/MVPを構築して検証し、その後計画を段階的に拡張する。
    - PoC/MVPの目標、実行、検証結果を文書化する。
  - **低信頼度（<66%）**
    - 最初のフェーズを研究と知識構築に専念する。
    - セマンティック検索を使用し、類似の実装を分析する。
    - 調査結果を研究文書に統合する。
    - 研究後に分析フェーズを再実行する。
    - 信頼度が低いままの場合のみエスカレートする。

- [ ] **技術設計を`design_test.md`に文書化する:**
  - **アーキテクチャ:** コンポーネントと相互作用の高レベルの概要（Mermaid記法で図を作成）。
  - **データフロー:** 図と説明（Mermaid記法を使用）。
  - **インターフェース:** APIコントラクト、スキーマ、公開関数シグネチャ。
  - **データモデル:** データ構造とデータベーススキーマ（ERD図はMermaid記法で作成）。

- [ ] **エラー処理を文書化する:**
  - 手順と期待される応答を含むエラーマトリックスを作成する。

- [ ] **単体テスト戦略を定義する。**

- [ ] **実装計画を作成する:**
  - 各タスクについて、説明、期待される結果、依存関係を含める。
  - 注: impl_tasks_test.mdは/docs/impl/に保存される。

**重要な制約:**

- **設計と計画が完成し検証されるまで次のフェーズには進まない。**